{"version":3,"file":"logger.js","sourceRoot":"","sources":["../../src/utils/logger.ts"],"names":[],"mappings":"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","sourcesContent":["import { Config } from '../types/binding.js';\nimport { ColorFunction, PersistentCacheBrand, colors } from './color.js';\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { pad, version } from './share.js';\n\ntype LogLevelNames = 'trace' | 'debug' | 'info' | 'warn' | 'error';\n\nenum LogLevel {\n  Trace = 'trace',\n  Debug = 'debug',\n  Info = 'info',\n  Warn = 'warn',\n  Error = 'error'\n}\n\nexport interface ILogger {\n  trace(message: string): void;\n  debug(message: string): void;\n  info(message: string): void;\n  warn(message: string): void;\n  warnOnce(message: string): void;\n  errorOnce(message: string | Error): void;\n  error(message: string | Error, options?: ErrorOptions): void;\n}\n\nexport interface ErrorOptions {\n  exit?: boolean;\n  e?: Error;\n  error?: Error;\n}\ninterface LoggerOptions {\n  name?: string;\n  brandColor?: ColorFunction;\n  exit?: boolean;\n}\n\nconst LOGGER_METHOD = {\n  info: 'log',\n  warn: 'warn',\n  error: 'error'\n} as const;\n\nconst warnOnceMessages = new Set();\nconst infoOnceMessages = new Set();\nconst errorOnceMessages = new Set();\n\nexport class Logger implements ILogger {\n  constructor(\n    public options?: LoggerOptions,\n    private levelValues: Record<LogLevelNames, number> = {\n      trace: 0,\n      debug: 1,\n      info: 2,\n      warn: 3,\n      error: 4\n    },\n    private prefix?: string\n  ) {\n    if (!this.options) this.options = {};\n    this.brandPrefix();\n  }\n\n  private brandPrefix(color?: (s: string | string[]) => string): void {\n    const { name = 'Farm' } = this.options;\n    const formattedName = colors.bold(name);\n    const formattedPrefix = colors.bold(`[ ${formattedName} ]`);\n    this.prefix = color ? color(formattedPrefix) : formattedPrefix;\n  }\n\n  private logMessage(\n    level: LogLevelNames,\n    message: string | Error,\n    color?: (s: string | string[]) => string,\n    showBanner = true\n  ): void {\n    const loggerMethod =\n      level in LOGGER_METHOD\n        ? LOGGER_METHOD[level as keyof typeof LOGGER_METHOD]\n        : 'log';\n    if (this.levelValues[level] <= this.levelValues[level]) {\n      const prefix = showBanner ? this.prefix + ' ' : '';\n      const loggerMessage = color ? color(prefix + message) : prefix + message;\n      console[loggerMethod](loggerMessage);\n    }\n  }\n\n  setPrefix(options: LoggerOptions): void {\n    if (options.name) {\n      this.options.name = options.name;\n      this.brandPrefix(options.brandColor);\n    }\n  }\n\n  trace(message: string): void {\n    this.brandPrefix(colors.green);\n    this.logMessage(LogLevel.Trace, message, colors.magenta);\n  }\n\n  debug(message: string): void {\n    this.brandPrefix(colors.debugColor);\n    this.logMessage(LogLevel.Debug, message, colors.blue);\n  }\n\n  info(message: string, iOptions?: LoggerOptions): void {\n    const options: LoggerOptions | undefined = iOptions;\n    if (options) {\n      this.setPrefix(options);\n    }\n    if (!options || !options.brandColor) {\n      this.brandPrefix(colors.brandColor);\n    }\n    this.logMessage(LogLevel.Info, message, null);\n  }\n\n  warn(message: string): void {\n    this.brandPrefix(colors.yellow);\n    this.logMessage(LogLevel.Warn, message, colors.yellow);\n  }\n\n  error(message: string | Error, errorOptions?: ErrorOptions): void {\n    this.brandPrefix(colors.red);\n\n    const effectiveOptions = { ...this.options, ...errorOptions };\n    const causeError = errorOptions?.e || errorOptions?.error;\n\n    let error;\n\n    if (typeof message === 'string') {\n      error = new Error(message);\n      error.stack = '';\n    } else {\n      error = message;\n    }\n\n    if (causeError) {\n      error.message += `\\nCaused by: ${causeError.stack ?? causeError}`;\n    }\n\n    this.logMessage(LogLevel.Error, error, colors.red);\n\n    if (effectiveOptions.exit) {\n      process.exit(1);\n    }\n  }\n  infoOnce(message: string) {\n    if (!infoOnceMessages.has(message)) {\n      infoOnceMessages.add(message);\n      this.info(message);\n    }\n  }\n  warnOnce(message: string) {\n    if (!warnOnceMessages.has(message)) {\n      warnOnceMessages.add(message);\n      this.warn(message);\n    }\n  }\n  errorOnce(message: string | Error) {\n    if (!errorOnceMessages.has(message)) {\n      errorOnceMessages.add(message);\n      this.error(message);\n    }\n  }\n  hasErrorLogged(message: string | Error) {\n    return errorOnceMessages.has(message);\n  }\n  hasWarnLogged(message: string) {\n    return warnOnceMessages.has(message);\n  }\n}\n\n// use in test\n// TODO: impl ILogger\nexport class NoopLogger extends Logger {\n  setPrefix(_options: LoggerOptions): void {}\n  trace(_message: string): void {}\n  debug(_message: string): void {}\n  info(_message: string, _iOptions?: LoggerOptions): void {}\n  warn(_message: string): void {}\n  error(_message: string | Error, _errorOptions?: ErrorOptions): void {\n    if (_errorOptions.exit) {\n      let e = _message instanceof Error ? _message : new Error(_message);\n      if (_errorOptions?.e || _errorOptions?.error) {\n        e.cause = _errorOptions.e || _errorOptions.error;\n      }\n\n      throw e;\n    }\n  }\n  infoOnce(_message: string): void {}\n  warnOnce(_message: string): void {}\n  errorOnce(_message: string | Error): void {}\n  hasErrorLogged(_message: string | Error): boolean {\n    return false;\n  }\n  hasWarnLogged(_message: string): boolean {\n    return false;\n  }\n}\n\nexport function printServerUrls(\n  urls: any,\n  logger: Logger,\n  previewFlag = false\n): void {\n  if (previewFlag)\n    logger.info(colors.bold(colors.magenta('preview server running at: \\n')));\n  const colorUrl = (url: string) =>\n    colors.cyan(url.replace(/:(\\d+)\\//, (_, port) => `:${colors.bold(port)}/`));\n\n  const logUrl = (url: string, type: string) =>\n    logger.info(\n      `${colors.bold(colors.magenta('>'))} ${colors.bold(type)}${colors.bold(\n        colorUrl(url)\n      )}`\n    );\n\n  urls.local.map((url: string) => logUrl(url, 'Local:   '));\n  urls.network.map((url: string) => logUrl(url, 'Network: '));\n}\n\nexport function bootstrapLogger(options?: LoggerOptions): Logger {\n  return new Logger(options);\n}\n\nexport function bootstrap(times: number, config: Config) {\n  const usePersistentCache = config.config.persistentCache;\n  const persistentCacheFlag = usePersistentCache\n    ? colors.bold(PersistentCacheBrand)\n    : '';\n\n  console.log(\n    '\\n',\n    colors.bold(colors.brandColor(`${'ϟ'}  Farm  v${version}`))\n  );\n  console.log(\n    `${colors.bold(colors.green(` ✓`))}  ${colors.bold(\n      'Ready in'\n    )} ${colors.bold(colors.green(`${times}ms`))} ${persistentCacheFlag}`,\n    '\\n'\n  );\n}\n\nexport const logger = new Logger();\n\nexport function buildErrorMessage(\n  err: any,\n  args: string[] = [],\n  includeStack = true\n): string {\n  if (err.plugin) args.push(`  Plugin: ${colors.magenta(err.plugin)}`);\n  const loc = err.loc ? `:${err.loc.line}:${err.loc.column}` : '';\n  if (err.id) args.push(`  File: ${colors.cyan(err.id)}${loc}`);\n  if (err.frame) args.push(colors.yellow(pad(err.frame)));\n  if (includeStack && err.stack) args.push(pad(cleanStack(err.stack)));\n  return args.join('\\n');\n}\n\nfunction cleanStack(stack: string) {\n  return stack\n    .split(/\\n/g)\n    .filter((l) => /^\\s*at/.test(l))\n    .join('\\n');\n}\n"]}