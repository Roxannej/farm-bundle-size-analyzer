{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../src/plugin/js/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import path from 'node:path';\n// import path from 'node:path';\nimport * as querystring from 'node:querystring';\nimport fse from 'fs-extra';\nimport type {\n  InternalModuleFormat,\n  NormalizedInputOptions,\n  NormalizedOutputOptions,\n  OutputAsset,\n  OutputChunk,\n  RenderedChunk,\n  RenderedModule\n} from 'rollup';\nimport { Config } from '../../types/binding.js';\nimport { JsResourcePotInfoData, Resource, ResourcePotInfo } from '../type.js';\nimport { VITE_ADAPTER_VIRTUAL_MODULE } from './constants.js';\n\nexport type WatchChangeEvents = 'create' | 'update' | 'delete';\n\nexport function convertEnforceToPriority(value: 'pre' | 'post' | undefined) {\n  const defaultPriority = 100;\n  const enforceToPriority = {\n    pre: 101,\n    post: 98\n  };\n\n  return enforceToPriority[value!] !== undefined\n    ? enforceToPriority[value!]\n    : defaultPriority;\n}\n\nexport function convertWatchEventChange(\n  value: WatchChangeEvents\n): WatchChangeEvents {\n  const watchEventChange = {\n    Added: 'create',\n    Updated: 'update',\n    Removed: 'delete'\n  } as unknown as { [key in WatchChangeEvents]: WatchChangeEvents };\n\n  return watchEventChange[value];\n}\n\nexport function getContentValue(content: any): string {\n  return encodeStr(typeof content === 'string' ? content : content!.code);\n}\n\nexport function isString(variable: unknown): variable is string {\n  return typeof variable === 'string';\n}\n\nexport function isObject(variable: unknown): variable is object {\n  return typeof variable === 'object' && variable !== null;\n}\n\nexport function customParseQueryString(url: string | null) {\n  if (!url) {\n    return [];\n  }\n\n  const queryString = url.split('?')[1];\n\n  const parsedParams = querystring.parse(queryString);\n  const paramsArray = [];\n\n  for (const key in parsedParams) {\n    paramsArray.push([key, parsedParams[key] as string]);\n  }\n\n  return paramsArray as [string, string][];\n}\n\nexport const VITE_PLUGIN_DEFAULT_MODULE_TYPE =\n  'VITE_PLUGIN_DEFAULT_MODULE_TYPE';\n\nexport const CSS_LANGS_RES: [RegExp, string][] = [\n  [/\\.(less)(?:$|\\?)/, 'less'],\n  [/\\.(scss|sass)(?:$|\\?)/, 'sass'],\n  [/\\.(styl|stylus)(?:$|\\?)/, 'stylus'],\n  [/\\.(css)(?:$|\\?)/, 'css']\n];\n\nexport const JS_LANGS_RES: [RegExp, string][] = [\n  [/\\.(js|mjs|cjs|)(?:$|\\?)/, 'js'],\n  // jsx\n  [/\\.(jsx)(?:$|\\?)/, 'jsx'],\n  // ts\n  [/\\.(ts|cts|mts)(?:$|\\?)/, 'ts'],\n  // tsx\n  [/\\.(tsx)(?:$|\\?)/, 'tsx']\n];\n\nexport const DEFAULT_FILTERS = ['!node_modules'];\n// farm css modules query\nexport const FARM_CSS_MODULES_SUFFIX = /(?:\\?|&)farm_css_modules/;\n\nexport const stringifyQuery = (query: [string, string][]) => {\n  if (!query.length) {\n    return '';\n  }\n\n  let queryStr = '';\n\n  for (const [key, value] of query) {\n    queryStr += `${key}${value ? `=${value}` : ''}&`;\n  }\n\n  return `${queryStr.slice(0, -1)}`;\n};\n\nexport function formatId(id: string, query: [string, string][]): string {\n  // remove the adapter internal virtual module flag\n  if (isStartAdapterVirtualModule(id)) {\n    id = id?.replace(VITE_ADAPTER_VIRTUAL_MODULE, '');\n  }\n\n  if (!query.length) {\n    return id;\n  }\n\n  return `${id}?${stringifyQuery(query)}`;\n}\n\n// determine if it is the adapter's internal virtual module\nexport function isStartAdapterVirtualModule(id: string) {\n  return id?.startsWith(VITE_ADAPTER_VIRTUAL_MODULE);\n}\n\nexport function isStartsWithSlash(str: string) {\n  return str?.startsWith('/');\n}\n\nexport function addAdapterVirtualModuleFlag(id: string) {\n  return VITE_ADAPTER_VIRTUAL_MODULE + id;\n}\n\nexport function normalizeAdapterVirtualModule(id: string) {\n  const path = removeQuery(id);\n  // If resolveIdResult is a path starting with / and the file at that path does not exist\n  // then it is considered an internal virtual module\n  if (isStartsWithSlash(path) && !fse.pathExistsSync(path))\n    return addAdapterVirtualModuleFlag(id);\n  return id;\n}\n\n// normalize path for windows the same as Vite\nexport function normalizePath(p: string): string {\n  return path.posix.normalize(\n    process.platform === 'win32' ? p.replace(/\\\\/g, '/') : p\n  );\n}\n\nexport const removeQuery = (path: string) => {\n  const queryIndex = path.indexOf('?');\n  if (queryIndex !== -1) {\n    return path.slice(0, queryIndex);\n  }\n  return revertNormalizePath(path.concat(''));\n};\n\nexport function revertNormalizePath(p: string): string {\n  return process.platform === 'win32' ? p.replace(/\\//g, '\\\\') : p;\n}\n\nexport function getCssModuleType(id: string): string | null {\n  for (const [reg, lang] of CSS_LANGS_RES) {\n    if (reg.test(id)) {\n      return lang;\n    }\n  }\n\n  return null;\n}\n\nexport function getJsModuleType(id: string): string | null {\n  for (const [reg, lang] of JS_LANGS_RES) {\n    if (reg.test(id)) {\n      return lang;\n    }\n  }\n\n  return null;\n}\n\nexport function formatLoadModuleType(id: string): string {\n  const cssModuleType = getCssModuleType(id);\n\n  if (cssModuleType) {\n    return cssModuleType;\n  }\n\n  const jsModuleType = getJsModuleType(id);\n\n  if (jsModuleType) {\n    return jsModuleType;\n  }\n\n  return 'js';\n}\n\nexport function formatTransformModuleType(id: string): string {\n  return formatLoadModuleType(id);\n}\n\n// normalize invalid characters in id, for example: \\0\n// because characters like \\0 have issues when passing to Farm's rust compiler\nexport function encodeStr(str: string): string {\n  return str.replace(/\\0/g, '\\\\0');\n}\n\nexport function decodeStr(str: string): string {\n  return str.replace(/\\\\0/g, '\\0');\n}\n\nexport function deleteUndefinedPropertyDeeply(obj: any) {\n  if (typeof obj !== 'object') {\n    return;\n  }\n\n  for (const key in obj) {\n    if (!Object.prototype.hasOwnProperty.call(obj, key)) {\n      continue;\n    }\n\n    if (Array.isArray(obj[key])) {\n      obj[key] = obj[key].filter((item: any) => item !== undefined);\n    } else if (obj[key] === undefined) {\n      delete obj[key];\n    } else if (typeof obj[key] === 'object') {\n      deleteUndefinedPropertyDeeply(obj[key]);\n    }\n  }\n}\n\nexport function throwIncompatibleError(\n  pluginName: string,\n  readingObject: string,\n  allowedKeys: string[],\n  key: string | number | symbol\n): never {\n  throw new Error(\n    `Vite plugin '${pluginName}' is not compatible with Farm for now. Because it uses ${readingObject}['${String(\n      key\n    )}'] which is not supported by Farm. Current supported keys are: ${allowedKeys.join(\n      ','\n    )}`\n  );\n}\n\nexport function transformResourceInfo2RollupRenderedChunk(\n  info: ResourcePotInfo\n): RenderedChunk {\n  const { modules, moduleIds, name, data } = info;\n\n  const {\n    dynamicImports,\n    importedBindings,\n    imports,\n    exports,\n    isDynamicEntry,\n    isEntry,\n    isImplicitEntry\n  } = data as JsResourcePotInfoData;\n\n  return {\n    dynamicImports,\n    fileName: name,\n    implicitlyLoadedBefore: [],\n    importedBindings,\n    imports,\n    modules: Object.entries(modules).reduce(\n      (result, [key, val]) => ({\n        ...result,\n        [key]: {\n          code: val.renderedContent,\n          renderedLength: val.renderedLength,\n          originalLength: val.originalLength,\n          removedExports: [],\n          renderedExports: []\n        }\n      }),\n      {} as Record<string, RenderedModule>\n    ),\n    referencedFiles: [],\n    exports,\n    facadeModuleId: null,\n    isDynamicEntry,\n    isEntry,\n    isImplicitEntry,\n    moduleIds,\n    name,\n    type: 'chunk'\n  } satisfies RenderedChunk;\n}\n\nexport function transformResourceInfo2RollupResource(\n  resource: Resource\n): OutputChunk | OutputAsset {\n  // Rollup/Vite only treat js files as chunk\n  if (resource.info && resource.resourceType === 'js') {\n    const source = Buffer.from(resource.bytes).toString('utf-8');\n    return {\n      ...transformResourceInfo2RollupRenderedChunk(resource.info),\n      type: 'chunk',\n      code: source,\n      name: resource.name,\n      map: undefined,\n      sourcemapFileName: null,\n      preliminaryFileName: resource.origin.value\n    } satisfies OutputChunk;\n  } else {\n    return {\n      fileName: resource.name,\n      name: resource.name,\n      needsCodeReference: false,\n      source: Uint8Array.from(resource.bytes),\n      type: 'asset'\n    } satisfies OutputAsset;\n  }\n}\n\nexport function transformRollupResource2FarmResource(\n  chunk: OutputChunk | OutputAsset,\n  originResource: Resource\n): Resource {\n  if (chunk.type === 'chunk') {\n    return {\n      ...originResource,\n      bytes: Array.from(Buffer.from(chunk.code)) as number[],\n      emitted: originResource.emitted,\n      name: chunk.name\n    };\n  } else {\n    return {\n      bytes: Array.from(chunk.source as Uint8Array) as number[],\n      emitted: originResource.emitted,\n      name: chunk.name,\n      origin: originResource.origin,\n      resourceType: originResource.resourceType\n    };\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst notSupport: (method: string) => (...args: any[]) => any =\n  (method) => () => {\n    console.warn(`${method} not support`);\n  };\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst noop: (...args: any) => any = () => void 0;\n\nfunction transformFarmFormatToRollupFormat(\n  config: Config['config']['output']\n): InternalModuleFormat {\n  if (config.format === 'esm') {\n    return 'es';\n  } else if (config.format === 'cjs') {\n    if (config.targetEnv === 'node') return 'cjs';\n    return 'amd';\n  }\n}\n\nexport function transformFarmConfigToRollupNormalizedOutputOptions(\n  config: Config['config']\n): NormalizedOutputOptions {\n  return {\n    amd: { autoId: false, define: 'define', forceJsExtensionForImports: false },\n    assetFileNames: config.output.assetsFilename,\n    chunkFileNames: config.output.filename,\n    compact: Boolean(config.minify),\n    dir: config.output.path,\n    dynamicImportInCjs: true,\n    entryFileNames: config.output.entryFilename,\n    esModule: 'if-default-prop',\n    experimentalMinChunkSize: config?.partialBundling?.targetMinSize || 1,\n    exports: 'auto',\n    extend: false,\n    externalImportAssertions: false,\n    // externalImportAttributes: true,\n    externalLiveBindings: true,\n    format: transformFarmFormatToRollupFormat(config.output),\n    freeze: false,\n    generatedCode: {\n      arrowFunctions: false,\n      constBindings: false,\n      objectShorthand: false,\n      reservedNamesAsProps: true,\n      symbols: false\n    },\n\n    globals: {},\n    hoistTransitiveImports: true,\n    indent: true,\n    inlineDynamicImports: false,\n    manualChunks: {},\n    minifyInternalExports: true,\n    noConflict: false,\n    paths: {},\n    plugins: [],\n    preserveModules: false,\n    sourcemap: Boolean(config.sourcemap),\n    sourcemapExcludeSources: false,\n    strict: true,\n    systemNullSetters: true,\n    validate: false,\n    banner: notSupport('banner'),\n    footer: notSupport('footer'),\n    interop: notSupport('interop'),\n    outro: notSupport('outro'),\n    intro: notSupport('intro'),\n    sanitizeFileName: notSupport('sanitizeFileName'),\n    sourcemapIgnoreList: notSupport('sourcemapIgnoreList'),\n\n    dynamicImportFunction: undefined,\n    experimentalDeepDynamicChunkOptimization: false,\n    file: undefined,\n    name: undefined,\n    namespaceToStringTag: false,\n    preferConst: false,\n    preserveModulesRoot: undefined,\n    sourcemapBaseUrl: undefined,\n    sourcemapFile: undefined,\n    sourcemapFileNames: undefined,\n    sourcemapPathTransform: undefined\n  } satisfies NormalizedOutputOptions;\n}\n\nexport function transformFarmConfigToRollupNormalizedInputOptions(\n  config: Config['config']\n): NormalizedInputOptions {\n  return {\n    context: 'undefined',\n    experimentalCacheExpiry: 10,\n    experimentalLogSideEffects: false,\n    input: config.input,\n    logLevel: 'info',\n    makeAbsoluteExternalsRelative: 'ifRelativeSource',\n    maxParallelFileOps: 20,\n    perf: false,\n    plugins: [],\n    preserveEntrySignatures: 'exports-only',\n    preserveSymlinks: false,\n    shimMissingExports: false,\n    strictDeprecations: false,\n    treeshake: config.treeShaking && {\n      moduleSideEffects: () => false,\n      annotations: true,\n      correctVarValueBeforeDeclaration: false,\n      manualPureFunctions: [],\n      propertyReadSideEffects: true,\n      tryCatchDeoptimization: true,\n      unknownGlobalSideEffects: true\n    },\n    acorn: undefined,\n    acornInjectPlugins: undefined,\n    cache: undefined,\n    external: undefined,\n    inlineDynamicImports: undefined,\n    manualChunks: undefined,\n    maxParallelFileReads: undefined,\n    moduleContext: undefined,\n    onLog: noop,\n    onwarn: noop,\n    preserveModules: undefined\n  } satisfies NormalizedInputOptions;\n}\n\nexport function normalizeFilterPath(path: string): string {\n  if (process.platform === 'win32') {\n    return compatibleWin32Path(path);\n  }\n\n  return path;\n}\n\nfunction compatibleWin32Path(path: string): string {\n  return path.replaceAll('/', '\\\\\\\\');\n}\n"]}