{"version":3,"file":"external-adapter.js","sourceRoot":"","sources":["../../../src/plugin/js/external-adapter.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,2BAA2B,CAAC;AACxD,OAAO,EACL,mBAAmB,EACnB,eAAe,EAChB,MAAM,qDAAqD,CAAC;AAE7D,OAAO,EAAE,OAAO,EAAE,MAAM,sBAAsB,CAAC;AAG/C;;GAEG;AACH,MAAM,UAAU,eAAe;IAC7B,OAAO;QACL,IAAI,EAAE,uBAAuB;QAE7B,QAAQ,EAAE,CAAC,QAAQ;QAEnB,MAAM,CAAC,MAAkB;YACvB,IACE,MAAM,EAAE,WAAW,EAAE,QAAQ;gBAC7B,OAAO,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,EACpC;gBACA,IAAI,CAAC,cAAc,EAAE,cAAc,CAAC,GAAG,mBAAmB,CACxD,MAAM,EAAE,WAAW,EACnB,eAAe,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,CAC7C,CAAC;gBAEF,OAAO;oBACL,WAAW,EAAE;wBACX,QAAQ,EAAE,cAAc;wBACxB,MAAM,EAAE;4BACN,CAAC,WAAW,CAAC,eAAe,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC;yBAC9D;qBACF;iBACF,CAAC;aACH;QACH,CAAC;KACF,CAAC;AACJ,CAAC","sourcesContent":["import { CUSTOM_KEYS } from '../../config/constants.js';\nimport {\n  mergeCustomExternal,\n  partialExternal\n} from '../../config/normalize-config/normalize-external.js';\nimport { UserConfig } from '../../config/types.js';\nimport { isArray } from '../../utils/share.js';\nimport { JsPlugin } from '../type.js';\n\n/**\n * avoid add new external in config hook\n */\nexport function externalAdapter(): JsPlugin {\n  return {\n    name: 'farm:external-adapter',\n\n    priority: -Infinity,\n\n    config(config: UserConfig): UserConfig | Promise<UserConfig> {\n      if (\n        config?.compilation?.external &&\n        isArray(config.compilation.external)\n      ) {\n        let [stringExternal, recordExternal] = mergeCustomExternal(\n          config?.compilation,\n          partialExternal(config.compilation.external)\n        );\n\n        return {\n          compilation: {\n            external: stringExternal,\n            custom: {\n              [CUSTOM_KEYS.external_record]: JSON.stringify(recordExternal)\n            }\n          }\n        };\n      }\n    }\n  };\n}\n"]}