{"version":3,"file":"farm-to-vite-config.js","sourceRoot":"","sources":["../../../src/plugin/js/farm-to-vite-config.ts"],"names":[],"mappings":"AAGA,OAAO,KAAK,MAAM,sBAAsB,CAAC;AACzC,OAAO,EAAE,aAAa,EAAE,mBAAmB,EAAE,MAAM,gBAAgB,CAAC;AACpE,OAAO,EACL,6BAA6B,EAC7B,sBAAsB,EACvB,MAAM,YAAY,CAAC;AAEpB,MAAM,UAAU,0BAA0B,CAAC,MAAkB;IAC3D,MAAM,WAAW,GAAG,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE;QACpE,IAAI,OAAO,MAAM,KAAK,UAAU,EAAE;YAChC,OAAO,MAAM,EAAE,CAAC,UAAU,CAAC;SAC5B;aAAM;YACL,OAAO,MAAM,CAAC;SACf;IACH,CAAC,CAAC,CAAC;IAEH,IAAI,SAAS,GAAG,IAAI,CAAC;IAErB,IAAI,MAAM,CAAC,WAAW,EAAE,SAAS,KAAK,SAAS,EAAE;QAC/C,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;KACpD;IAED,MAAM,UAAU,GAAmB;QACjC,IAAI,EAAE,MAAM,CAAC,IAAI;QACjB,IAAI,EAAE,MAAM,CAAC,WAAW,EAAE,MAAM,EAAE,UAAU,IAAI,GAAG;QACnD,SAAS,EAAE,MAAM,CAAC,SAAS,IAAI,QAAQ;QACvC,IAAI,EAAE,MAAM,CAAC,WAAW,EAAE,IAAI;QAC9B,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE,MAAM;QAClC,6DAA6D;QAC7D,+BAA+B;QAC/B,OAAO,EAAE,MAAM,CAAC,WAAW,EAAE,IAAI,KAAK,YAAY,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO;QACtE,OAAO,EAAE;YACP,KAAK,EAAE,MAAM,CAAC,WAAW,EAAE,OAAO,EAAE,KAAK;YACzC,UAAU,EAAE,MAAM,CAAC,WAAW,EAAE,OAAO,EAAE,UAAU;YACnD,UAAU,EAAE,MAAM,CAAC,WAAW,EAAE,OAAO,EAAE,UAAU;YACnD,UAAU,EAAE,MAAM,CAAC,WAAW,EAAE,OAAO,EAAE,UAAU;YACnD,gBAAgB,EAAE,MAAM,CAAC,WAAW,EAAE,OAAO,EAAE,QAAQ,KAAK,KAAK;YACjE,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE,OAAO,EAAE,MAAM;SAC5C;QACD,OAAO,EAAE,WAAW;QACpB,MAAM,EAAE;YACN,6DAA6D;YAC7D,0BAA0B;YAC1B,GAAG,EAAE,MAAM,CAAC,MAAM,EAAE,GAAG;YACvB,IAAI,EAAE,MAAM,CAAC,MAAM,EAAE,IAAI;YACzB,IAAI,EAAE,MAAM,CAAC,MAAM,EAAE,IAAI;YACzB,UAAU,EAAE,MAAM,CAAC,MAAM,EAAE,UAAU;YACrC,KAAK,EAAE,MAAM,CAAC,MAAM,EAAE,KAAK;YAC3B,KAAK,EAAE,MAAM,CAAC,MAAM,EAAE,KAAY;YAClC,IAAI,EAAE,MAAM,CAAC,MAAM,EAAE,IAAI;YACzB,KAAK,EACH,OAAO,MAAM,CAAC,MAAM,EAAE,GAAG,KAAK,QAAQ;gBACpC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,YAAY,IAAI,EAAE;gBACvC,CAAC,CAAC,EAAE;YACR,0CAA0C;SAC3C;QACD,6DAA6D;QAC7D,+BAA+B;QAC/B,YAAY,EAAE,MAAM,CAAC,WAAW,EAAE,IAAI,KAAK,YAAY;QACvD,GAAG,EAAE,MAAM,CAAC,WAAW,EAAE,GAAG,EAAE,eAAe,IAAI,EAAE;QACnD,KAAK,EAAE;YACL,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE,MAAM,EAAE,IAAI;YACxC,SAAS;YACT,MAAM,EACJ,MAAM,CAAC,WAAW,EAAE,MAAM,KAAK,SAAS;gBACtC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,EAAE,MAAM,CAAC;gBACrC,CAAC,CAAC,SAAS;YACf,SAAS,EACP,MAAM,CAAC,WAAW,EAAE,MAAM,KAAK,SAAS;gBACtC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,EAAE,MAAM,CAAC;gBACrC,CAAC,CAAC,SAAS;YACf,GAAG,EAAE,MAAM,CAAC,WAAW,EAAE,MAAM,EAAE,SAAS,KAAK,MAAM;YACrD,aAAa,EAAE;gBACb,MAAM,EAAE;oBACN,cAAc,EAAE,MAAM,CAAC,WAAW,EAAE,MAAM,EAAE,cAAc;oBAC1D,cAAc,EAAE,MAAM,CAAC,WAAW,EAAE,MAAM,EAAE,aAAa;oBACzD,cAAc,EAAE,MAAM,CAAC,WAAW,EAAE,MAAM,EAAE,QAAQ;iBACrD;aACF;YACD,0CAA0C;SAC3C;QACD,4BAA4B;QAC5B,QAAQ,EAAE,0BAA0B;QACpC,MAAM,EAAE,MAAM,CAAC,MAAM;QACrB,aAAa,EAAE;YACb,GAAG,mBAAmB;YACtB,GAAG,CAAC,MAAM,CAAC,WAAW,EAAE,MAAM,EAAE,OAAO,IAAI,EAAE,CAAC;SAC/C;QACD,YAAY,EAAE,EAAE;KACjB,CAAC;IAEF,OAAO,UAAU,CAAC;AACpB,CAAC;AAED,SAAS,cAAc,CACrB,SAAc,EAAE,EAChB,GAAoB,EACpB,WAAqB,EACrB,WAGC,EACD,MAA0C;IAE1C,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;QAC3B,OAAO,MAAM,CAAC,GAAqC,CAAC,CAAC;KACtD;IAED,IAAI,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;QAC/B,OAAQ,MAA8B,CAAC,GAAG,CAAC,CAAC;KAC7C;IAED,IAAI,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE;QACrC,IAAI,MAAM,EAAE;YACV,OAAO,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;SAC5B;aAAM;YACL,OAAO,MAAM,CAAC,GAAG,CAAC,CAAC;SACpB;KACF;IAED,MAAM,sBAAsB,CAC1B,WAAW,CAAC,UAAU,EACtB,WAAW,CAAC,OAAO,EACnB,WAAW,EACX,GAAG,CACJ,CAAC;AACJ,CAAC;AAED,SAAS,cAAc,CACrB,UAAkB,EAClB,OAAe,EACf,WAAqB,EACrB,MAAW,EAAE;IAEb,OAAO,IAAI,KAAK,CAAC,GAAG,IAAI,EAAE,EAAE;QAC1B,GAAG,CAAC,MAAM,EAAE,GAAG;YACb,OAAO,cAAc,CAAC,MAAM,EAAE,GAAG,EAAE,WAAW,EAAE;gBAC9C,UAAU;gBACV,OAAO;aACR,CAAC,CAAC;QACL,CAAC;KACF,CAAC,CAAC;AACL,CAAC;AAED,SAAS,UAAU,CAAC,UAAkB,EAAE,MAAW,EAAE;IACnD,MAAM,kBAAkB,GAAG;QACzB,OAAO;QACP,YAAY;QACZ,YAAY;QACZ,YAAY;QACZ,kBAAkB;QAClB,sEAAsE;QACtE,QAAQ;KACT,CAAC;IAEF,OAAO,cAAc,CACnB,UAAU,EACV,oBAAoB,EACpB,kBAAkB,EAClB,GAAG,CACJ,CAAC;AACJ,CAAC;AAED,SAAS,SAAS,CAAC,UAAkB,EAAE,MAAW,EAAE;IAClD,MAAM,iBAAiB,GAAG;QACxB,KAAK;QACL,MAAM;QACN,MAAM;QACN,YAAY;QACZ,OAAO;QACP,OAAO;QACP,MAAM;QACN,QAAQ;QACR,OAAO;KACR,CAAC;IAEF,OAAO,cAAc,CACnB,UAAU,EACV,mBAAmB,EACnB,iBAAiB,EACjB,GAAG,CACJ,CAAC;AACJ,CAAC;AAED,SAAS,MAAM,CAAC,UAAkB,EAAE,MAAW,EAAE;IAC/C,MAAM,cAAc,GAAG;QACrB,cAAc;QACd,aAAa;QACb,SAAS;QACT,SAAS;QACT,qBAAqB;KACtB,CAAC;IAEF,OAAO,cAAc,CAAC,UAAU,EAAE,gBAAgB,EAAE,cAAc,EAAE,GAAG,CAAC,CAAC;AAC3E,CAAC;AAED,SAAS,QAAQ,CAAC,UAAkB,EAAE,MAAW,EAAE;IACjD,MAAM,gBAAgB,GAAG;QACvB,QAAQ;QACR,WAAW;QACX,QAAQ;QACR,WAAW;QACX,KAAK;QACL,OAAO;QACP,eAAe;QACf,WAAW;KACZ,CAAC;IAEF,OAAO,cAAc,CAAC,UAAU,EAAE,kBAAkB,EAAE,gBAAgB,EAAE,GAAG,CAAC,CAAC;AAC/E,CAAC;AAED,MAAM,UAAU,eAAe,CAC7B,UAA0B,EAC1B,UAAkB,EAClB,MAAc;IAEd,OAAO,IAAI,KAAK,CAAC,UAAU,EAAE;QAC3B,GAAG,CAAC,MAAM,EAAE,GAAG;YACb,MAAM,WAAW,GAAG;gBAClB,MAAM;gBACN,MAAM;gBACN,WAAW;gBACX,MAAM;gBACN,QAAQ;gBACR,SAAS;gBACT,SAAS;gBACT,SAAS;gBACT,QAAQ;gBACR,cAAc;gBACd,KAAK;gBACL,OAAO;gBACP,QAAQ;gBACR,UAAU;gBACV,QAAQ;gBACR,eAAe;gBACf,4CAA4C;gBAC5C,uCAAuC;gBACvC,QAAQ;gBACR,cAAc;gBACd,KAAK;gBACL,UAAU;gBACV,cAAc;gBACd,MAAM;gBACN,aAAa;gBACb,cAAc;gBACd,sCAAsC;gBACtC,kCAAkC;gBAClC,YAAY;gBACZ,cAAc;aACf,CAAC;YAEF,OAAO,cAAc,CACnB,MAAM,EACN,GAAG,EACH,WAAW,EACX;gBACE,UAAU;gBACV,OAAO,EAAE,YAAY;aACtB,EACD,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE;gBACd,MAAM,SAAS,GAGX;oBACF,OAAO,EAAE,UAAU;oBACnB,MAAM,EAAE,SAAS;oBACjB,GAAG,EAAE,MAAM;oBACX,KAAK,EAAE,QAAQ;oBACf,YAAY,EAAE,CAAC,UAAkB,EAAE,MAAW,EAAE,EAAE,EAAE;wBAClD,OAAO,IAAI,KAAK,CAAC,GAAG,IAAI,EAAE,EAAE;4BAC1B,GAAG,CAAC,CAAC,EAAE,eAAe;gCACpB,MAAM,CAAC,QAAQ,CACb,iBAAiB,UAAU,kHAAkH,MAAM,CACjJ,eAAe,CAChB,GAAG,CACL,CAAC;gCAEF,IAAI,eAAe,KAAK,gBAAgB,EAAE;oCACxC,OAAO,EAAE,CAAC;iCACX;gCACD,OAAO,SAAS,CAAC;4BACnB,CAAC;yBACF,CAAC,CAAC;oBACL,CAAC;oBACD,MAAM,EAAE,GAAG,EAAE;wBACX,OAAO,MAAM,CAAC;oBAChB,CAAC;oBACD,aAAa,EAAE,GAAG,EAAE;wBAClB,OAAO,CAAC,QAAgB,EAAE,EAAE;4BAC1B,OAAO,CACJ,UAAU,CAAC,aAA0B,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE;gCACjD,OAAO,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;4BACtC,CAAC,CAAC,IAAI,KAAK,CACZ,CAAC;wBACJ,CAAC,CAAC;oBACJ,CAAC;iBACF,CAAC;gBAEF,OAAO,SAAS,CAAC,GAAG,CAAC;oBACnB,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,UAAU,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC;oBACzC,CAAC,CAAC,MAAM,CAAC,GAA0B,CAAC,CAAC;YACzC,CAAC,CACF,CAAC;QACJ,CAAC;KACF,CAAC,CAAC;AACL,CAAC;AAED,MAAM,UAAU,sBAAsB,CACpC,MAAsB,EACtB,cAA0B,EAC1B,WAAmB;;IAEnB,MAAM,UAAU,GAAe;QAC7B,WAAW,EAAE,EAAE;KAChB,CAAC;IAEF,IAAI,MAAM,CAAC,IAAI,EAAE;QACf,UAAU,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;KAC/B;IACD,IAAI,MAAM,EAAE,GAAG,EAAE;QACf,MAAA,UAAU,CAAC,WAAW,EAAC,GAAG,QAAH,GAAG,GAAK,EAAE,EAAC;QAClC,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,eAAe,GAAG,MAAM,CAAC,GAAG,CAAC;KACzD;IAED,IAAI,MAAM,CAAC,IAAI,EAAE;QACf,MAAA,UAAU,CAAC,WAAW,EAAC,MAAM,QAAN,MAAM,GAAK,EAAE,EAAC;QACrC,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC;KACxD;IACD,IAAI,MAAM,CAAC,SAAS,EAAE;QACpB,UAAU,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,CAAC;KACzC;IACD,IAAI,MAAM,CAAC,IAAI,KAAK,aAAa,IAAI,MAAM,CAAC,IAAI,KAAK,YAAY,EAAE;QACjE,UAAU,CAAC,WAAW,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;KAC3C;IACD,IAAI,MAAM,CAAC,MAAM,EAAE;QACjB,UAAU,CAAC,WAAW,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;KAC/C;IAED,IAAI,MAAM,CAAC,OAAO,EAAE;QAClB,MAAA,UAAU,CAAC,WAAW,EAAC,OAAO,QAAP,OAAO,GAAK,EAAE,EAAC;QAEtC,IAAI,MAAM,CAAC,OAAO,CAAC,KAAK,EAAE;YACxB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACxC,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,KAGrD,CAAC;aACH;iBAAM;gBACL,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,EAAE;oBACzC,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,GAAG,EAAE,CAAC;iBAC3C;gBAED,MAAM,eAAe,GAAG,gBAAgB,CAAC;gBAEzC,KAAK,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,MAAM,CAAC,OAAO,CAAC,KAAK,EAAE;oBACxD,IAAI,IAAI,YAAY,MAAM,EAAE;wBAC1B,MAAM,GAAG,GAAG,eAAe,GAAG,IAAI,CAAC,MAAM,CAAC;wBAC1C,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,WAAW,CAAC;qBACzD;yBAAM;wBACL,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,WAAW,CAAC;qBAC1D;iBACF;aACF;SACF;QAED,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,UAAU,GAAG,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QACtE,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,UAAU,GAAG,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QACtE,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,UAAU,GAAG,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QACtE,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,QAAQ;YACrC,MAAM,CAAC,OAAO,CAAC,gBAAgB,IAAI,IAAI,CAAC;KAC3C;IAED,IAAI,MAAM,CAAC,MAAM,EAAE;QACjB,UAAU,CAAC,MAAM,KAAjB,UAAU,CAAC,MAAM,GAAK,EAAE,EAAC;QACzB,UAAU,CAAC,MAAM,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC;QAC1C,UAAU,CAAC,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC;QAE5C,IAAI,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE;YACvB,IACE,UAAU,CAAC,MAAM,EAAE,GAAG,KAAK,IAAI;gBAC/B,UAAU,CAAC,MAAM,EAAE,GAAG,KAAK,SAAS,EACpC;gBACA,UAAU,CAAC,MAAM,CAAC,GAAG,GAAG;oBACtB,GAAG,CAAC,OAAO,cAAc,EAAE,MAAM,EAAE,GAAG,KAAK,QAAQ;wBACjD,CAAC,CAAC,cAAc,CAAC,MAAM,CAAC,GAAG;wBAC3B,CAAC,CAAC,EAAE,CAAC;oBACP,YAAY,EAAE,MAAM,CAAC,MAAM,CAAC,KAAK;iBAClC,CAAC;aACH;SACF;QAED,IAAI,OAAO,MAAM,CAAC,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;YAC1C,UAAU,CAAC,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC;SAC7C;QAED,UAAU,CAAC,MAAM,CAAC,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC;QACxD,UAAU,CAAC,MAAM,CAAC,KAAK;YACrB,OAAO,MAAM,CAAC,MAAM,CAAC,KAAK,KAAK,SAAS;gBACtC,CAAC,CAAC,SAAS;gBACX,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC;QAC1B,UAAU,CAAC,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,KAAY,CAAC;QACrD,UAAU,CAAC,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KACtD;IAED,IAAI,MAAM,CAAC,KAAK,EAAE;QAChB,MAAA,UAAU,CAAC,WAAW,EAAC,MAAM,QAAN,MAAM,GAAK,EAAE,EAAC;QACrC,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAEzD,IACE,MAAM,CAAC,KAAK,EAAE,SAAS,KAAK,SAAS;YACrC,cAAc,CAAC,WAAW,EAAE,SAAS,KAAK,SAAS,EACnD;YACA,UAAU,CAAC,WAAW,CAAC,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;SACpE;QAED,IACE,MAAM,CAAC,KAAK,CAAC,GAAG,KAAK,SAAS;YAC9B,cAAc,CAAC,WAAW,EAAE,eAAe,KAAK,SAAS,EACzD;YACA,UAAU,CAAC,WAAW,CAAC,eAAe,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC;SAC5D;QAED,IAAI,MAAM,CAAC,KAAK,CAAC,aAAa,EAAE,MAAM,KAAK,SAAS,EAAE;YACpD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE;gBACrD,MAAM,IAAI,GAAG,CAAC,gBAAgB,EAAE,eAAe,EAAE,UAAU,CAAC,CAAC;gBAE7D,KAAK,MAAM,CAAC,IAAI,IAAI,EAAE;oBACpB,sDAAsD;oBACtD,6BAA6B;oBAC7B,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC;wBAC9B,6BAA6B;wBAC7B,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;iBACxC;aACF;SACF;KACF;IAED,6BAA6B,CAAC,UAAU,CAAC,CAAC;IAE1C,OAAO,KAAK,CAAC,EAAE,EAAE,cAAc,EAAE,UAAU,CAAC,CAAC;AAC/C,CAAC","sourcesContent":["import type { UserConfig as ViteUserConfig } from 'vite';\nimport type { UserConfig } from '../../config/types.js';\nimport { Logger } from '../../index.js';\nimport merge from '../../utils/merge.js';\nimport { EXTERNAL_KEYS, VITE_DEFAULT_ASSETS } from './constants.js';\nimport {\n  deleteUndefinedPropertyDeeply,\n  throwIncompatibleError\n} from './utils.js';\n\nexport function farmUserConfigToViteConfig(config: UserConfig): ViteUserConfig {\n  const vitePlugins = config.vitePlugins.filter(Boolean).map((plugin) => {\n    if (typeof plugin === 'function') {\n      return plugin().vitePlugin;\n    } else {\n      return plugin;\n    }\n  });\n\n  let sourcemap = true;\n\n  if (config.compilation?.sourcemap !== undefined) {\n    sourcemap = Boolean(config.compilation?.sourcemap);\n  }\n\n  const viteConfig: ViteUserConfig = {\n    root: config.root,\n    base: config.compilation?.output?.publicPath ?? '/',\n    publicDir: config.publicDir ?? 'public',\n    mode: config.compilation?.mode,\n    define: config.compilation?.define,\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore ignore this error\n    command: config.compilation?.mode === 'production' ? 'build' : 'serve',\n    resolve: {\n      alias: config.compilation?.resolve?.alias,\n      extensions: config.compilation?.resolve?.extensions,\n      mainFields: config.compilation?.resolve?.mainFields,\n      conditions: config.compilation?.resolve?.conditions,\n      preserveSymlinks: config.compilation?.resolve?.symlinks === false,\n      dedupe: config.compilation?.resolve?.dedupe\n    },\n    plugins: vitePlugins,\n    server: {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore ignore error\n      hmr: config.server?.hmr,\n      port: config.server?.port,\n      host: config.server?.host,\n      strictPort: config.server?.strictPort,\n      https: config.server?.https,\n      proxy: config.server?.proxy as any,\n      open: config.server?.open,\n      watch:\n        typeof config.server?.hmr === 'object'\n          ? config.server.hmr?.watchOptions ?? {}\n          : {}\n      // other options are not supported in farm\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore ignore this error\n    isProduction: config.compilation?.mode === 'production',\n    css: config.compilation?.css?._viteCssOptions ?? {},\n    build: {\n      outDir: config.compilation?.output?.path,\n      sourcemap,\n      minify:\n        config.compilation?.minify !== undefined\n          ? Boolean(config.compilation?.minify)\n          : undefined,\n      cssMinify:\n        config.compilation?.minify !== undefined\n          ? Boolean(config.compilation?.minify)\n          : undefined,\n      ssr: config.compilation?.output?.targetEnv === 'node',\n      rollupOptions: {\n        output: {\n          assetFileNames: config.compilation?.output?.assetsFilename,\n          entryFileNames: config.compilation?.output?.entryFilename,\n          chunkFileNames: config.compilation?.output?.filename\n        }\n      }\n      // other options are not supported in farm\n    },\n    // TODO make it configurable\n    cacheDir: 'node_modules/.farm/cache',\n    envDir: config.envDir,\n    assetsInclude: [\n      ...VITE_DEFAULT_ASSETS,\n      ...(config.compilation?.assets?.include ?? [])\n    ],\n    experimental: {}\n  };\n\n  return viteConfig;\n}\n\nfunction getTargetField(\n  target: any = {},\n  key: string | symbol,\n  allowedKeys: string[],\n  contextInfo: {\n    pluginName: string;\n    keyName: string;\n  },\n  getter?: (target: any, key: string) => any\n): any {\n  if (typeof key !== 'string') {\n    return target[key as unknown as keyof typeof target];\n  }\n\n  if (EXTERNAL_KEYS.includes(key)) {\n    return (target as Record<string, any>)[key];\n  }\n\n  if (allowedKeys.includes(String(key))) {\n    if (getter) {\n      return getter(target, key);\n    } else {\n      return target[key];\n    }\n  }\n\n  throw throwIncompatibleError(\n    contextInfo.pluginName,\n    contextInfo.keyName,\n    allowedKeys,\n    key\n  );\n}\n\nfunction createProxyObj(\n  pluginName: string,\n  keyName: string,\n  allowedKeys: string[],\n  obj: any = {}\n) {\n  return new Proxy(obj || {}, {\n    get(target, key) {\n      return getTargetField(target, key, allowedKeys, {\n        pluginName,\n        keyName\n      });\n    }\n  });\n}\n\nfunction mapResolve(pluginName: string, obj: any = {}) {\n  const allowedResolveKeys = [\n    'alias',\n    'extensions',\n    'mainFields',\n    'conditions',\n    'preserveSymlinks',\n    // farm do not set any thing for dedupe, it should always be undefined\n    'dedupe'\n  ];\n\n  return createProxyObj(\n    pluginName,\n    'viteConfig.resolve',\n    allowedResolveKeys,\n    obj\n  );\n}\n\nfunction mapServer(pluginName: string, obj: any = {}) {\n  const allowedServerKeys = [\n    'hmr',\n    'port',\n    'host',\n    'strictPort',\n    'https',\n    'proxy',\n    'open',\n    'origin',\n    'watch'\n  ];\n\n  return createProxyObj(\n    pluginName,\n    'viteConfig.server',\n    allowedServerKeys,\n    obj\n  );\n}\n\nfunction mapCss(pluginName: string, obj: any = {}) {\n  const allowedCssKeys = [\n    'devSourcemap',\n    'transformer',\n    'modules',\n    'postcss',\n    'preprocessorOptions'\n  ];\n\n  return createProxyObj(pluginName, 'viteConfig.css', allowedCssKeys, obj);\n}\n\nfunction mapBuild(pluginName: string, obj: any = {}) {\n  const allowedBuildKeys = [\n    'outDir',\n    'sourcemap',\n    'minify',\n    'cssMinify',\n    'ssr',\n    'watch',\n    'rollupOptions',\n    'assetsDir'\n  ];\n\n  return createProxyObj(pluginName, 'viteConfig.build', allowedBuildKeys, obj);\n}\n\nexport function proxyViteConfig(\n  viteConfig: ViteUserConfig,\n  pluginName: string,\n  logger: Logger\n): ViteUserConfig {\n  return new Proxy(viteConfig, {\n    get(target, key) {\n      const allowedKeys = [\n        'root',\n        'base',\n        'publicDir',\n        'mode',\n        'define',\n        'command',\n        'resolve',\n        'plugins',\n        'server',\n        'isProduction',\n        'css',\n        'build',\n        'logger',\n        'cacheDir',\n        'envDir',\n        'assetsInclude',\n        // these fields are always undefined in farm\n        // they are only used for compatibility\n        'legacy',\n        'optimizeDeps',\n        'ssr',\n        'logLevel',\n        'experimental',\n        'test',\n        'clearScreen',\n        'customLogger',\n        // compat @vanilla-extract/vite-plugin\n        // these options are undefined now\n        'configFile',\n        'inlineConfig'\n      ];\n\n      return getTargetField(\n        target,\n        key,\n        allowedKeys,\n        {\n          pluginName,\n          keyName: 'viteConfig'\n        },\n        (target, key) => {\n          const keyMapper: Record<\n            string,\n            (pluginName: string, obj: any) => any\n          > = {\n            resolve: mapResolve,\n            server: mapServer,\n            css: mapCss,\n            build: mapBuild,\n            optimizeDeps: (pluginName: string, obj: any = {}) => {\n              return new Proxy(obj || {}, {\n                get(_, optimizeDepsKey) {\n                  logger.warnOnce(\n                    `[vite-plugin] ${pluginName}: config \"optimizeDeps\" is not needed in farm, all of its options will be ignored. Current ignored option is: \"${String(\n                      optimizeDepsKey\n                    )}\"`\n                  );\n\n                  if (optimizeDepsKey === 'esbuildOptions') {\n                    return {};\n                  }\n                  return undefined;\n                }\n              });\n            },\n            logger: () => {\n              return logger;\n            },\n            assetsInclude: () => {\n              return (filename: string) => {\n                return (\n                  (viteConfig.assetsInclude as string[])?.some((r) => {\n                    return new RegExp(r).test(filename);\n                  }) ?? false\n                );\n              };\n            }\n          };\n\n          return keyMapper[key]\n            ? keyMapper[key](pluginName, target[key])\n            : target[key as keyof typeof target];\n        }\n      );\n    }\n  });\n}\n\nexport function viteConfigToFarmConfig(\n  config: ViteUserConfig,\n  origFarmConfig: UserConfig,\n  _pluginName: string\n): UserConfig {\n  const farmConfig: UserConfig = {\n    compilation: {}\n  };\n\n  if (config.root) {\n    farmConfig.root = config.root;\n  }\n  if (config?.css) {\n    farmConfig.compilation.css ??= {};\n    farmConfig.compilation.css._viteCssOptions = config.css;\n  }\n\n  if (config.base) {\n    farmConfig.compilation.output ??= {};\n    farmConfig.compilation.output.publicPath = config.base;\n  }\n  if (config.publicDir) {\n    farmConfig.publicDir = config.publicDir;\n  }\n  if (config.mode === 'development' || config.mode === 'production') {\n    farmConfig.compilation.mode = config.mode;\n  }\n  if (config.define) {\n    farmConfig.compilation.define = config.define;\n  }\n\n  if (config.resolve) {\n    farmConfig.compilation.resolve ??= {};\n\n    if (config.resolve.alias) {\n      if (!Array.isArray(config.resolve.alias)) {\n        farmConfig.compilation.resolve.alias = config.resolve.alias as Record<\n          string,\n          any\n        >;\n      } else {\n        if (!farmConfig.compilation.resolve.alias) {\n          farmConfig.compilation.resolve.alias = {};\n        }\n\n        const farmRegexPrefix = '$__farm_regex:';\n\n        for (const { find, replacement } of config.resolve.alias) {\n          if (find instanceof RegExp) {\n            const key = farmRegexPrefix + find.source;\n            farmConfig.compilation.resolve.alias[key] = replacement;\n          } else {\n            farmConfig.compilation.resolve.alias[find] = replacement;\n          }\n        }\n      }\n    }\n\n    farmConfig.compilation.resolve.extensions = config.resolve.extensions;\n    farmConfig.compilation.resolve.mainFields = config.resolve.mainFields;\n    farmConfig.compilation.resolve.conditions = config.resolve.conditions;\n    farmConfig.compilation.resolve.symlinks =\n      config.resolve.preserveSymlinks != true;\n  }\n\n  if (config.server) {\n    farmConfig.server ??= {};\n    farmConfig.server.hmr = config.server.hmr;\n    farmConfig.server.port = config.server.port;\n\n    if (config.server.watch) {\n      if (\n        farmConfig.server?.hmr === true ||\n        farmConfig.server?.hmr === undefined\n      ) {\n        farmConfig.server.hmr = {\n          ...(typeof origFarmConfig?.server?.hmr === 'object'\n            ? origFarmConfig.server.hmr\n            : {}),\n          watchOptions: config.server.watch\n        };\n      }\n    }\n\n    if (typeof config.server.host === 'string') {\n      farmConfig.server.host = config.server.host;\n    }\n\n    farmConfig.server.strictPort = config.server.strictPort;\n    farmConfig.server.https =\n      typeof config.server.https === 'boolean'\n        ? undefined\n        : config.server.https;\n    farmConfig.server.proxy = config.server.proxy as any;\n    farmConfig.server.open = Boolean(config.server.open);\n  }\n\n  if (config.build) {\n    farmConfig.compilation.output ??= {};\n    farmConfig.compilation.output.path = config.build.outDir;\n\n    if (\n      config.build?.sourcemap !== undefined &&\n      origFarmConfig.compilation?.sourcemap === undefined\n    ) {\n      farmConfig.compilation.sourcemap = Boolean(config.build.sourcemap);\n    }\n\n    if (\n      config.build.ssr !== undefined &&\n      origFarmConfig.compilation?.lazyCompilation === undefined\n    ) {\n      farmConfig.compilation.lazyCompilation = !config.build.ssr;\n    }\n\n    if (config.build.rollupOptions?.output !== undefined) {\n      if (!Array.isArray(config.build.rollupOptions.output)) {\n        const keys = ['assetFileNames', 'entryFilename', 'filename'];\n\n        for (const k of keys) {\n          /* eslint-disable @typescript-eslint/ban-ts-comment */\n          // @ts-ignore type is correct\n          farmConfig.compilation.output[k] =\n            // @ts-ignore type is correct\n            config.build.rollupOptions.output[k];\n        }\n      }\n    }\n  }\n\n  deleteUndefinedPropertyDeeply(farmConfig);\n\n  return merge({}, origFarmConfig, farmConfig);\n}\n"]}